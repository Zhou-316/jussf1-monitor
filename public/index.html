<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç–æ‹¾ä½“è‚²æŠ¢ç¥¨åŠ©æ‰‹ - å…¨çœ‹å°ç›‘æ§</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --success: #10b981;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; color: var(--text-main); }
        .container { width: 100%; max-width: 600px; background: var(--card-bg); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden; }
        
        /* å¤´éƒ¨ */
        .header { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 25px; text-align: center; }
        .header h1 { margin: 0; font-size: 24px; font-weight: 700; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 14px; }

        /* æ§åˆ¶åŒº */
        .controls { display: flex; gap: 10px; padding: 20px; border-bottom: 1px solid #eee; background: #fff; justify-content: center; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-start { background: var(--success); color: white; }
        .btn-start:hover:not(:disabled) { background: #059669; transform: translateY(-1px); }
        .btn-stop { background: #ef4444; color: white; }
        .btn-stop:hover:not(:disabled) { background: #dc2626; }
        
        /* ç¥¨åŠ¡åˆ—è¡¨ */
        .ticket-list { padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .ticket-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px 20px; background: #f9fafb; border-radius: 12px; border: 1px solid #e5e7eb; transition: 0.3s;
        }
        
        /* æœ‰ç¥¨æ—¶çš„æ ·å¼ */
        .ticket-item.active { 
            background: #d1fae5; border-color: #34d399; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2); 
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        .info { display: flex; flex-direction: column; }
        .name { font-size: 17px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .price { font-size: 12px; background: #e5e7eb; padding: 2px 6px; border-radius: 4px; color: #4b5563; font-weight: normal; }
        .count-badge { font-size: 13px; color: var(--text-sub); margin-top: 4px; }
        
        .ticket-item.active .count-badge { color: #047857; font-weight: bold; }
        
        .action-btn { 
            text-decoration: none; background: #e5e7eb; color: #9ca3af; 
            padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 600; 
            pointer-events: none; transition: 0.2s; 
        }
        
        .ticket-item.active .action-btn { 
            background: var(--primary); color: white; pointer-events: auto; cursor: pointer;
            box-shadow: 0 2px 5px rgba(37, 99, 235, 0.3);
        }
        .ticket-item.active .action-btn:hover { background: #1d4ed8; }

        /* æ—¥å¿—åŒº */
        .log-area { background: #111827; color: #34d399; padding: 15px; margin: 0 20px 20px; border-radius: 10px; font-family: monospace; font-size: 12px; height: 150px; overflow-y: auto; }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid #1f2937; padding-bottom: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ« å…¨çœ‹å°æŠ¢ç¥¨åŠ©æ‰‹</h1>
        <p>A / B / H / K å®æ—¶ç›‘æ§ä¸­</p>
    </div>

    <div class="controls">
        <button id="startBtn" class="btn btn-start" onclick="sendAction('start')">â–¶ å¯åŠ¨ç›‘æ§</button>
        <button id="stopBtn" class="btn btn-stop" onclick="sendAction('stop')" disabled>â¹ åœæ­¢ç›‘æ§</button>
    </div>

    <div class="ticket-list">
        <!-- Aä¸Š -->
        <div class="ticket-item" id="row-A_TOP">
            <div class="info">
                <div class="name">å‘¨å…­ Aä¸Š <span class="price">$990</span></div>
                <div class="count-badge" id="count-A_TOP">ç­‰å¾…æ‰«æ...</div>
            </div>
            <a href="https://ztmen.jussyun.com/booking/693133c84996310001244e59?from=content&isFree=false" target="_blank" class="action-btn">å»æŠ¢ç¥¨</a>
        </div>

        <!-- Aä¸‹ -->
        <div class="ticket-item" id="row-A_BOTTOM">
            <div class="info">
                <div class="name">å‘¨å…­ Aä¸‹ <span class="price">$780</span></div>
                <div class="count-badge" id="count-A_BOTTOM">ç­‰å¾…æ‰«æ...</div>
            </div>
            <a href="https://ztmen.jussyun.com/booking/693133c84996310001244e59?from=content&isFree=false" target="_blank" class="action-btn">å»æŠ¢ç¥¨</a>
        </div>

        <!-- B -->
        <div class="ticket-item" id="row-B">
            <div class="info">
                <div class="name">å‘¨å…­ Bçœ‹å° <span class="price">$740</span></div>
                <div class="count-badge" id="count-B">ç­‰å¾…æ‰«æ...</div>
            </div>
            <a href="https://ztmen.jussyun.com/booking/693132f64996310001244995?from=content&isFree=false" target="_blank" class="action-btn">å»æŠ¢ç¥¨</a>
        </div>

        <!-- H -->
        <div class="ticket-item" id="row-H">
            <div class="info">
                <div class="name">å‘¨å…­ Hçœ‹å° <span class="price">$660</span></div>
                <div class="count-badge" id="count-H">ç­‰å¾…æ‰«æ...</div>
            </div>
            <a href="https://ztmen.jussyun.com/booking/6931529204da960001255be6?from=content&isFree=false" target="_blank" class="action-btn">å»æŠ¢ç¥¨</a>
        </div>

        <!-- K -->
        <div class="ticket-item" id="row-K">
            <div class="info">
                <div class="name">å‘¨å…­ Kçœ‹å° <span class="price">$660</span></div>
                <div class="count-badge" id="count-K">ç­‰å¾…æ‰«æ...</div>
            </div>
            <a href="https://ztmen.jussyun.com/booking/693152ad04da960001255d56?from=content&isFree=false" target="_blank" class="action-btn">å»æŠ¢ç¥¨</a>
        </div>
    </div>

    <div class="log-area" id="log-window">
        <div>ç³»ç»Ÿå°±ç»ª...</div>
    </div>
    <div style="text-align: center; color: #9ca3af; font-size: 12px; margin-bottom: 15px;">æœ€åæ›´æ–°: <span id="last-update">-</span></div>
</div>

<script>
    const socket = io();
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const logDiv = document.getElementById('log-window');

    // å‘é€æŒ‡ä»¤
    function sendAction(action) {
        socket.emit(action);
    }

    // æ¥æ”¶è¿è¡ŒçŠ¶æ€
    socket.on('status', (isRunning) => {
        if (isRunning) {
            startBtn.disabled = true;
            startBtn.innerHTML = "ç›‘æ§è¿è¡Œä¸­...";
            stopBtn.disabled = false;
        } else {
            startBtn.disabled = false;
            startBtn.innerHTML = "â–¶ å¯åŠ¨ç›‘æ§";
            stopBtn.disabled = true;
        }
    });

    // æ¥æ”¶è¯¦ç»†æ•°æ®å¹¶æ›´æ–° UI (æ ¸å¿ƒé€»è¾‘)
    socket.on('data_update', (data) => {
        // data æ ¼å¼: { "A_TOP": 0, "B": 2 ... }
        updateRow('A_TOP', data['A_TOP']);
        updateRow('A_BOTTOM', data['A_BOTTOM']);
        updateRow('B', data['B']);
        updateRow('H', data['H']);
        updateRow('K', data['K']);
        
        document.getElementById('last-update').innerText = new Date().toLocaleTimeString();
    });

    function updateRow(key, count) {
        const row = document.getElementById(`row-${key}`);
        const badge = document.getElementById(`count-${key}`);
        
        if (count > 0) {
            // æœ‰ç¥¨ï¼šå˜ç»¿ã€æ¿€æ´»æŒ‰é’®
            row.classList.add('active');
            badge.innerText = `ğŸ”¥ ç°æœ‰ ${count} å¼ ä½™ç¥¨ï¼`;
        } else {
            // æ— ç¥¨ï¼šæ¢å¤åŸæ ·
            row.classList.remove('active');
            badge.innerText = "æš‚æ— ä½™ç¥¨ (æ‰«æä¸­...)";
        }
    }

    // æ—¥å¿—æ˜¾ç¤º
    socket.on('log', (msg) => {
        const p = document.createElement('div');
        p.className = 'log-line';
        p.innerText = msg;
        logDiv.appendChild(p);
        logDiv.scrollTop = logDiv.scrollHeight;
    });

    // å¼¹çª—æŠ¥è­¦
    socket.on('ticket_alert', (msg) => {
        // æµè§ˆå™¨å¼ºæé†’
        alert(`ğŸ‰ æŠ¢ç¥¨æé†’ï¼š\n${msg}\n\nè¯·ç‚¹å‡»å¯¹åº”çœ‹å°çš„â€œå»æŠ¢ç¥¨â€æŒ‰é’®ï¼`);
    });

</script>

</body>
</html>